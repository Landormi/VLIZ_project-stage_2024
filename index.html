<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub OAuth Login</title>
</head>
<body>
    <h1>GitHub OAuth Login</h1>
    <div id="content">
        <!-- Contenu de la page pour la connexion -->
        <p>Logging in with GitHub...</p>
    </div>
    <script>
        const CLIENT_ID = 'Ov23lixU1XxqIib5KkT3';
        const CLIENT_SECRET = '326909b94f082c5cda2d261f0decda36e671de4e'; // Note: This should be kept secret and managed securely.

        function fetchAccessToken(code) {
            const xhr = new XMLHttpRequest();
            xhr.open('POST', 'https://github.com/login/oauth/access_token', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('Accept', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        const data = JSON.parse(xhr.responseText);
                        sessionStorage.setItem('accessToken', data.access_token);
                        window.location.href = 'display.html';
                    } else {
                        document.getElementById('content').innerHTML = '<p>Error fetching access token. Please try logging in again.</p>';
                    }
                }
            };

            const body = JSON.stringify({
                client_id: CLIENT_ID,
                client_secret: CLIENT_SECRET,
                code: code
            });

            xhr.send(body);
        }

        function handleLogin() {
            // Check if there's a code in the URL
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');

            if (code) {
                // If there is a code, exchange it for an access token
                fetchAccessToken(code);
            } else {
                // If there's no code, initiate the GitHub OAuth flow
                const githubAuthUrl = `https://github.com/login/oauth/authorize?client_id=${CLIENT_ID}&scope=repo`;
                window.location.href = githubAuthUrl;
            }
        }

        // Start handling login flow when the page loads
        handleLogin();
    </script>
</body>
</html>
